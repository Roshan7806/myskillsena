<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fast Math Game - SkillSena</title>
  <style>
    /* your same styles here... */
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDeStwcK3nJQdmLXtyWUZ52E30abBUAYBA",
      authDomain: "apnaskillsena.firebaseapp.com",
      databaseURL: "https://apnaskillsena-default-rtdb.firebaseio.com",
      projectId: "apnaskillsena",
      storageBucket: "apnaskillsena.appspot.com",
      messagingSenderId: "149529300642",
      appId: "1:149529300642:web:2e07cdea6e7933133491fb"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body>
  <div class="top-bar">
    <div>👤 <span id="username">User</span></div>
    <div>💰 Coins: ₹<span id="balance">0</span></div>
  </div>
  <div class="container">
    <div class="game-box">
      <h2>🧠 Fast Math Game</h2>
      <label for="bet">📌 Select Bet Amount:</label>
      <select id="bet">
        <option value="10">₹10</option>
        <option value="20">₹20</option>
        <option value="50">₹50</option>
        <option value="100">₹100</option>
        <option value="200">₹200</option>
        <option value="300">₹300</option>
        <option value="400">₹400</option>
        <option value="500">₹500</option>
      </select>
      <button onclick="startGame()">🎮 Start Game</button>
    </div>
  </div>

  <script>
    let userId = null;
    let userRef = null;

    window.addEventListener("DOMContentLoaded", function () {
      userId = sessionStorage.getItem("loggedInUser");

      if (!userId) {
        alert("Please login first.");
        window.location.href = "login.html";
        return;
      }

      userRef = firebase.database().ref("users/" + userId);
      userRef.once("value").then((snapshot) => {
        const user = snapshot.val();
        document.getElementById("username").textContent = user.name || "User";
        document.getElementById("balance").textContent = user.balance || 0;
      });
    });

    function startGame() {
      if (!userRef) {
        alert("Please login first.");
        window.location.href = "login.html";
        return;
      }

      const bet = parseInt(document.getElementById("bet").value);

      userRef.once("value").then((snapshot) => {
        const user = snapshot.val();
        if (!user || user.balance === undefined) {
          alert("User data not found.");
          return;
        }

        if (user.balance < bet) {
          alert("❌ You don't have enough coins!");
          return;
        }

        // Update balance
        const newBalance = user.balance - bet;
        userRef.update({ balance: newBalance });

        // Store current bet
        sessionStorage.setItem("current_bet", bet);

        // Go to game page
        window.location.href = "play-fast-math.html";
      });
    }
  </script>
</body>
</html>
