<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - SKILLSENA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Style remains same (no change) -->
  <style>
    /* 👇 your full CSS remains unchanged */
    /* ... (same as you sent) ... */
  </style>

  <!-- ✅ Correct Firebase Scripts (compat version) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDeStwcK3nJQdmLXtyWUZ52E30abBUAYBA",
      authDomain: "apnaskillsena.firebaseapp.com",
      databaseURL: "https://apnaskillsena-default-rtdb.firebaseio.com",
      projectId: "apnaskillsena",
      storageBucket: "apnaskillsena.appspot.com",
      messagingSenderId: "149529300642",
      appId: "1:149529300642:web:2e07cdea6e7933133491fb"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
  </script>
</head>
<body>
  <div class="dashboard-box">
    <img src="skillsena.png" alt="Skillsena Logo">
    <h2>👋 Welcome, <span id="username">User</span></h2>
    <p class="info">📱 Mobile: <span id="mobile">---</span></p>
    <p class="info">💰 Coins: ₹<span id="balance">0</span></p>
    <hr>

    <a href="fast-math.html" class="btn btn-blue">🧮 Play Fast Math</a>
    <a href="typing-game.html" class="btn btn-blue">⌨ Play Typing Game</a>
    <a href="deposit.html" class="btn btn-blue">💸 Deposit</a>
    <a href="withdrawal.html" class="btn btn-blue">🏦 Withdraw</a>
    <a href="game-results.html" class="btn btn-blue">📊 Game Results</a>
    <a href="contact.html" class="btn btn-blue">📞 Contact Us</a>
    <a href="about.html" class="btn btn-blue">ℹ About Us</a>
    <a href="security.html" class="btn btn-blue">🔐 Security</a>
    <button class="btn btn-red" onclick="logout()">🔓 Logout</button>
  </div>

  <!-- ✅ Broadcast Popup -->
  <div id="broadcastPopup">
    <button onclick="closeBroadcast()">✖</button>
    <img id="broadcastImg" src="" />
    <p id="broadcastText"></p>
  </div>

  <!-- ✅ Bonus Popup -->
  <div id="bonusPopup">
    <p id="bonusMessage"></p>
    <button onclick="closeBonus()">OK</button>
  </div>

  <!-- ✅ Dashboard Logic -->
  <script>
    const mobile = localStorage.getItem("loggedInUser");

    if (!mobile) {
      alert("Please login first.");
      window.location.href = "login.html";
    } else {
      const userRef = database.ref("users/" + mobile);
      userRef.once("value").then(snapshot => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          if (data.status === "blocked") {
            alert("Your account has been blocked.");
            localStorage.removeItem("loggedInUser");
            window.location.href = "login.html";
          } else {
            document.getElementById("username").textContent = data.name || "User";
            document.getElementById("mobile").textContent = data.mobile || "---";
            document.getElementById("balance").textContent = data.coins || 0;
          }
        } else {
          alert("User data not found.");
          localStorage.removeItem("loggedInUser");
          window.location.href = "login.html";
        }
      }).catch(error => {
        console.error("Error fetching user data:", error);
      });
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      alert("Logged out.");
      window.location.href = "login.html";
    }

    // ✅ Broadcast Message
    const broadcastRef = database.ref("broadcast_data");
    broadcastRef.once("value").then(snapshot => {
      const data = snapshot.val();
      if (data && data.image && data.message) {
        document.getElementById("broadcastImg").src = data.image;
        document.getElementById("broadcastText").textContent = data.message;
        document.getElementById("broadcastPopup").style.display = "block";
      }
    });

    function closeBroadcast() {
      document.getElementById("broadcastPopup").style.display = "none";
    }

    // ✅ Bonus Message
    const bonusRef = database.ref("bonus_message/" + mobile);
    bonusRef.once("value").then(snapshot => {
      const message = snapshot.val();
      if (message) {
        document.getElementById("bonusMessage").textContent = message;
        document.getElementById("bonusPopup").style.display = "block";
        bonusRef.remove(); // show only once
      }
    });

    function closeBonus() {
      document.getElementById("bonusPopup").style.display = "none";
    }
  </script>
</body>
</html>
